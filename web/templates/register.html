{% comment %} <title>{% block title %}My App{% endblock %}</title>
{% endcomment %}
<title>Registro | Traffic Pulse</title>

<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
  crossorigin="anonymous" />
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

<div class="container-fluid m-0 row bg-primary" style="min-height: 100%">
  <main class="form-signin col-md-6 py-4 m-auto bg-white rounded">
    <div class="container-fluid bg-secondary">
      <h4 class="text-center mb-3">Bienvenido, crea tu cuenta</h4>
    </div>
    <form action="" method="post" id="registro-form" novalidate>
      <div class="form-floating mb-3">
        <input
          type="text"
          class="form-control"
          id="username"
          placeholder="Usuario"
          required />
        <label for="username">Usuario</label>
        <div class="invalid-feedback">Ingresa un usuario válido.</div>
      </div>

      <div class="form-floating mb-3">
        <input
          type="email"
          class="form-control"
          id="email"
          placeholder="name@example.com"
          required />
        <label for="email">Correo electronico</label>
        <div class="invalid-feedback">Ingresa un correo válido.</div>
      </div>

      {% comment %}
      <div class="form-floating mb-3 position-relative">
        <input
          type="password"
          class="form-control password-input"
          id="password1"
          placeholder="Contraseña"
          required />
        <label for="password1">Password</label>
        <button
          type="button"
          class="position-absolute end-0 top-0 m-3 me-4 btn btn-outline-secondary btn-sm toggle-password">
          <i class="bi bi-eye toggle-icon"></i>
        </button>
        <div class="invalid-feedback">
          Ingresa una contraseña válido (tamaño >5).
        </div>
      </div>
      {% endcomment %}

      <div class="position-relative d-flex w-100">
        <div class="form-floating mb-3 position-relative col-11">
          <input
            type="password"
            class="form-control password-input"
            id="password1"
            placeholder="Contraseña"
            required />
          <label for="password1">Contraseña</label>
          <div class="invalid-feedback position-absolute">
            Ingresa una contraseña válido (tamaño >5).
          </div>
        </div>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm toggle-password mb-3 col-1">
          <i class="bi bi-eye toggle-icon"></i>
        </button>
      </div>

      <div class="position-relative d-flex w-100">
        <div class="form-floating mb-3 position-relative col-11">
          <input
            type="password"
            class="form-control password-input"
            id="password2"
            placeholder="Confirmar contraseña"
            required />
          <label for="password2">Confirmar Contraseña</label>
          <div class="invalid-feedback position-absolute">
            Las contraseñas no coinciden.
          </div>
        </div>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm toggle-password mb-3 col-1">
          <i class="bi bi-eye toggle-icon"></i>
        </button>
      </div>

      {% comment %}
      <div class="form-floating mb-3 position-relative">
        <input
          type="password"
          class="form-control password-input"
          id="password2"
          placeholder="Confirmar contraseña"
          required />
        <label for="password2">Confirmar Contraseña</label>
        <button
          type="button"
          class="position-absolute end-0 top-0 m-3 btn btn-outline-secondary btn-sm toggle-password">
          <i class="bi bi-eye toggle-icon"></i>
        </button>
        <div class="invalid-feedback">Las contraseñas no coinciden.</div>
      </div>
      {% endcomment %}
      <p class="text-muted text-end pe-4" style="font-size: 0.75rem">
        ¿Ya tienes una cuenta?
        <a href="{%url 'login'%}" class="">Iniciar Sesión</a>
      </p>
      <div class="d-flex justify-content-end pe-4">
        <button type="submit" class="btn btn-secondary">Crear cuenta</button>
      </div>
    </form>
  </main>
</div>
<script>
  const form = document.getElementById("registro-form");
  const username = document.getElementById("username");
  const emailInput = document.getElementById("email");
  const password1 = document.getElementById("password1");
  const password2 = document.getElementById("password2");

  const passwordFields = document.querySelectorAll(".password-input");
  const toggleButtons = document.querySelectorAll(".toggle-password");

  // Mostrar/ocultar contraseñas
  toggleButtons.forEach((button, index) => {
    const icon = button.querySelector(".toggle-icon");
    const input = passwordFields[index];

    button.addEventListener("click", () => {
      const type =
        input.getAttribute("type") === "password" ? "text" : "password";
      input.setAttribute("type", type);
      icon.classList.toggle("bi-eye");
      icon.classList.toggle("bi-eye-slash");
    });
  });

  // Validación al enviar el formulario
  form.addEventListener("submit", function (e) {
    let valid = true;

    // Limpiar clases anteriores
    [username, emailInput, password1, password2].forEach((input) => {
      input.classList.remove("is-invalid");
    });

    // Validar usuario
    if (username.value.trim() === "") {
      username.classList.add("is-invalid");
      valid = false;
    }

    // Validar email
    const emailValue = emailInput.value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (emailValue === "" || !emailRegex.test(emailValue)) {
      emailInput.classList.add("is-invalid");
      valid = false;
    }

    // Validar contraseña no vacía y longitud mínima
    if (password1.value.length < 6) {
      password1.classList.add("is-invalid");
      valid = false;
    }

    // Validar que las contraseñas coincidan
    if (password1.value !== password2.value) {
      password2.classList.add("is-invalid");
      valid = false;
    }

    // Cancelar envío si hay errores
    if (!valid) {
      e.preventDefault();
    }
  });
</script>

{% comment %}
<div class="row m-auto justify-content-center pt-5" style="min-height: 100vh">
  <div class="container col-sm-10 col-lg-6 p-5">
    <form action="php/verificar_contra.php" method="POST">
      <input type="hidden" name="email" value="<?php echo $email; ?>" />
      <div class="mb-3 position-relative">
        <input
          class="form-control p-3"
          type="password"
          name="password"
          id="password-input"
          placeholder="Dirrec"
          required />
      </div>
      <div class="mb-3 position-relative">
        <input
          class="form-control p-3"
          type="password"
          name="password"
          id="password-input"
          placeholder="*Contraseña"
          required />
        <button
          type="button"
          id="toggle-password"
          class="position-absolute end-0 top-0 m-3 btn btn-outline-secondary btn-sm">
          <i id="toggle-icon" class="bi bi-eye"></i>
        </button>
      </div>
      <div>
        <a href="" class="text-secondary">¿Olvidaste tu contraseña?</a>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-dark mt-3 py-3 px-5 rounded-5">
          <strong>Iniciar sesión</strong>
        </button>
      </div>
    </form>
  </div>
</div>
{% endcomment %}
