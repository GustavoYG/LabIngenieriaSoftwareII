{% comment %} <title>{% block title %}My App{% endblock %}</title>
{% endcomment %}
<title>Registro | Traffic Pulse</title>

<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
  crossorigin="anonymous" />
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
{% load static %}

<div class="container-fluid m-0 row bg-primary" style="min-height: 100%">
  <main class="form-signin row col-md-6 py-4 m-auto bg-white rounded">
    <div class="container-fluid col col-md-6">
      <img
        src="{% static 'images/user-icon.webp' %}"
        class="img-fluid w-100 mx-auto d-block mb-4"
        style="max-width: 200px"
        alt="user-icon" />
      <h4 class="text-center mb-4 text-muted">Bienvenido, crea tu cuenta</h4>
    </div>
    <form action="" method="post" id="registro-form" novalidate>
      <div class="form-floating mb-3">
        <input
          type="text"
          class="form-control"
          id="username"
          placeholder="Usuario"
          required />
        <label for="username">Usuario</label>
        <div class="invalid-feedback">Ingresa un usuario válido.</div>
      </div>

      <div class="form-floating mb-3">
        <input
          type="email"
          class="form-control"
          id="email"
          placeholder="name@example.com"
          required />
        <label for="email">Correo electronico</label>
        <div class="invalid-feedback">Ingresa un correo válido.</div>
      </div>
      <div class="position-relative mb-3">
        <div class="form-floating position-relative col-11 d-flex w-100">
          <input
            type="password"
            class="form-control password-input"
            id="password1"
            placeholder="Contraseña"
            required />
          <label for="password1">Contraseña</label>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm toggle-password col-1 border-secondary-subtle">
            <i class="bi bi-eye toggle-icon"></i>
          </button>
        </div>
        <div class="invalid-feedback">
          Ingresa una contraseña válido (tamaño >5).
        </div>
      </div>

      <div class="position-relative mb-3">
        <div class="form-floating position-relative col-11 d-flex w-100">
          <input
            type="password"
            class="form-control password-input"
            id="password2"
            placeholder="Confirmar contraseña"
            required />
          <label for="password2">Confirmar Contraseña</label>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm toggle-password col-1 border-secondary-subtle">
            <i class="bi bi-eye toggle-icon"></i>
          </button>
        </div>
        <div class="invalid-feedback">Las contraseñas no coinciden.</div>
      </div>

      <p class="text-muted text-end pe-4" style="font-size: 0.8em">
        ¿Ya tienes una cuenta?
        <a
          href="{%url 'login'%}"
          class="link-offset-1-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover"
          >Iniciar Sesión</a
        >
      </p>
      <div class="d-flex justify-content-end pe-4">
        <button type="submit" class="btn btn-secondary">Crear cuenta</button>
      </div>
    </form>
  </main>
</div>
<script>
  const form = document.getElementById("registro-form");
  const username = document.getElementById("username");
  const emailInput = document.getElementById("email");
  const password1 = document.getElementById("password1");
  const password2 = document.getElementById("password2");

  const passwordFields = document.querySelectorAll(".password-input");
  const toggleButtons = document.querySelectorAll(".toggle-password");

  // Mostrar/ocultar contraseñas
  toggleButtons.forEach((button, index) => {
    const icon = button.querySelector(".toggle-icon");
    const input = passwordFields[index];

    button.addEventListener("click", () => {
      const type =
        input.getAttribute("type") === "password" ? "text" : "password";
      input.setAttribute("type", type);
      icon.classList.toggle("bi-eye");
      icon.classList.toggle("bi-eye-slash");
    });
  });

  // Validación al enviar el formulario
  form.addEventListener("submit", function (e) {
    let valid = true;

    // Limpiar clases anteriores
    [username, emailInput, password1, password2].forEach((input) => {
      input.classList.remove("is-invalid");
    });

    // Validar usuario
    if (username.value.trim() === "") {
      username.classList.add("is-invalid");
      valid = false;
    }

    // Validar email
    const emailValue = emailInput.value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (emailValue === "" || !emailRegex.test(emailValue)) {
      emailInput.classList.add("is-invalid");
      valid = false;
    }

    // Validar contraseña no vacía y longitud mínima
    if (password1.value.length < 6) {
      password1.parentElement.classList.add("is-invalid");
      valid = false;
    }

    // Validar que las contraseñas coincidan
    if (password1.value !== password2.value) {
      password2.parentElement.classList.add("is-invalid");
      valid = false;
    }

    // Cancelar envío si hay errores
    if (!valid) {
      e.preventDefault();
    }
  });
</script>
